<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Moderno - Amarillo/Blanco</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .sidebar {
            transition: all 0.3s;
        }
        .sidebar.collapsed {
            transform: translateX(-100%);
            position: absolute;
            z-index: 50;
            height: 100vh;
        }
        @media (min-width: 768px) {
            .sidebar.collapsed {
                transform: translateX(-80%);
                width: 4rem;
                overflow: hidden;
            }
            .sidebar.collapsed:hover {
                transform: translateX(0);
                width: 16rem;
            }
            .sidebar.collapsed .nav-text {
                display: none;
            }
            .sidebar.collapsed:hover .nav-text {
                display: inline;
            }
            .sidebar.collapsed .logo-text {
                display: none;
            }
            .sidebar.collapsed:hover .logo-text {
                display: inline;
            }
        }
        .hidden {
            display: none;
        }
        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div id="app" v-cloak>
        <!-- Pantalla de Autenticación -->
        <div v-if="!currentUser" class="w-full max-w-md mx-auto my-12 bg-white rounded-lg shadow-md overflow-hidden">
            <div class="bg-yellow-400 p-6 text-center">
                <i class="fas fa-shopping-cart text-white text-4xl"></i>
                <h1 class="text-2xl font-bold text-white mt-2">Punto de Venta</h1>
            </div>
            
            <div class="p-6">
                <!-- Formulario de Login -->
                <form v-if="showLogin" @submit.prevent="login" class="mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Iniciar Sesión</h2>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Email</label>
                        <input v-model="loginEmail" type="email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Contraseña</label>
                        <input v-model="loginPassword" type="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                    </div>
                    <button type="submit" class="w-full bg-yellow-400 text-white py-2 rounded-lg font-semibold hover:bg-yellow-500">Ingresar</button>
                </form>
                
                <!-- Formulario de Registro -->
                <form v-else @submit.prevent="signup">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Registrarse</h2>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Nombre</label>
                        <input v-model="signupName" type="text" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Email</label>
                        <input v-model="signupEmail" type="email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Contraseña</label>
                        <input v-model="signupPassword" type="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Tipo de Usuario</label>
                        <select v-model="signupRole" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400">
                            <option value="comprador">Comprador</option>
                            <option value="vendedor">Vendedor</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-yellow-400 text-white py-2 rounded-lg font-semibold hover:bg-yellow-500">Registrarse</button>
                </form>
                
                <div class="text-center mt-4">
                    <a href="#" @click="toggleAuthForm" class="text-yellow-600 hover:underline">
                        {{ showLogin ? '¿No tienes cuenta? Regístrate aquí' : '¿Ya tienes cuenta? Inicia sesión aquí' }}
                    </a>
                </div>
            </div>
        </div>

        <!-- Sistema POS -->
        <div v-if="currentUser" class="flex h-screen overflow-hidden">
            <!-- Sidebar -->
            <div class="sidebar bg-white w-64 border-r border-gray-200 flex flex-col" :class="{ 'collapsed': isSidebarCollapsed }">
                <!-- Logo -->
                <div class="bg-yellow-400 p-4 flex items-center justify-center">
                    <i class="fas fa-shopping-cart text-white text-2xl mr-2"></i>
                    <span class="text-white font-bold text-xl logo-text">POS Moderno</span>
                </div>
                
                <!-- Menú -->
                <div class="flex-1 overflow-y-auto">
                    <nav class="mt-6">
                        <div class="px-4">
                            <p class="text-gray-500 uppercase text-xs font-semibold mb-4 nav-text">Principal</p>
                            <a href="#" @click="currentView = 'dashboard'" class="flex items-center py-2 px-4" :class="currentView === 'dashboard' ? 'bg-yellow-100 text-yellow-700' : 'text-gray-700 hover:bg-yellow-50'">
                                <i class="fas fa-home mr-3"></i>
                                <span class="nav-text">Inicio</span>
                            </a>
                        </div>
                        
                        <div class="px-4 mt-8">
                            <p class="text-gray-500 uppercase text-xs font-semibold mb-4 nav-text">Ventas</p>
                            <a href="#" @click="currentView = 'sales'" class="flex items-center py-2 px-4" :class="currentView === 'sales' ? 'bg-yellow-100 text-yellow-700' : 'text-gray-700 hover:bg-yellow-50'">
                                <i class="fas fa-cash-register mr-3"></i>
                                <span class="nav-text">Nueva Venta</span>
                            </a>
                            <a href="#" @click="currentView = 'history'" class="flex items-center py-2 px-4 mt-1" :class="currentView === 'history' ? 'bg-yellow-100 text-yellow-700' : 'text-gray-700 hover:bg-yellow-50'">
                                <i class="fas fa-history mr-3"></i>
                                <span class="nav-text">Historial</span>
                            </a>
                        </div>
                        
                        <div class="px-4 mt-8">
                            <p class="text-gray-500 uppercase text-xs font-semibold mb-4 nav-text">Productos</p>
                            <a href="#" @click="currentView = 'products'" class="flex items-center py-2 px-4" :class="currentView === 'products' ? 'bg-yellow-100 text-yellow-700' : 'text-gray-700 hover:bg-yellow-50'">
                                <i class="fas fa-boxes mr-3"></i>
                                <span class="nav-text">Inventario</span>
                            </a>
                            <a v-if="userRole === 'vendedor'" href="#" @click="currentView = 'add-product'" class="flex items-center py-2 px-4 mt-1" :class="currentView === 'add-product' ? 'bg-yellow-100 text-yellow-700' : 'text-gray-700 hover:bg-yellow-50'">
                                <i class="fas fa-plus-circle mr-3"></i>
                                <span class="nav-text">Agregar Producto</span>
                            </a>
                        </div>
                    </nav>
                </div>
                
                <!-- Usuario y botón para colapsar/expandir -->
                <div class="p-4 border-t border-gray-200">
                    <div class="flex items-center">
                        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="Usuario" class="w-10 h-10 rounded-full">
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-800 nav-text">{{ userName }}</p>
                            <p class="text-xs text-gray-500 nav-text">{{ userRole === 'vendedor' ? 'Vendedor' : 'Comprador' }}</p>
                        </div>
                        <button @click="toggleSidebar" class="ml-auto text-gray-500 hover:text-gray-700">
                            <i :class="isSidebarCollapsed ? 'fas fa-chevron-right' : 'fas fa-chevron-left'"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Contenido Principal -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <!-- Header -->
                <header class="bg-white border-b border-gray-200 py-4 px-6 flex items-center justify-between">
                    <button class="text-gray-600 hover:text-gray-900" @click="toggleSidebar">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    
                    <div class="relative flex-1 max-w-md mx-4">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" v-model="searchQuery" @input="filterProducts" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent" placeholder="Buscar productos...">
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button class="text-gray-600 hover:text-gray-900 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span v-if="notificationsCount > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">{{ notificationsCount }}</span>
                        </button>
                    </div>
                </header>
                
                <!-- Contenido Dinámico -->
                <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
                    <!-- Dashboard -->
                    <div v-if="currentView === 'dashboard'" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Resumen</h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-gray-600">Bienvenido, {{ userName }}</p>
                                    <p class="text-sm text-gray-500">Rol: {{ userRole === 'vendedor' ? 'Vendedor' : 'Comprador' }}</p>
                                </div>
                                <div v-if="userRole === 'vendedor'" class="bg-yellow-50 p-4 rounded-lg">
                                    <p class="font-semibold text-yellow-700">Total de productos: {{ products.length }}</p>
                                </div>
                                <div v-if="userRole === 'comprador'" class="bg-yellow-50 p-4 rounded-lg">
                                    <p class="font-semibold text-yellow-700">Productos en carrito: {{ Object.keys(cart).length }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="userRole === 'vendedor'" class="bg-white rounded-lg shadow p-6 col-span-2">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Ventas Recientes</h3>
                            <div v-if="sales.length > 0" class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Comprador</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr v-for="sale in sales.slice(0, 5)" :key="sale.id">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ formatDate(sale.date) }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.buyerName }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-yellow-600">${{ sale.total.toFixed(2) }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p v-else class="text-gray-500">No hay ventas recientes</p>
                        </div>
                    </div>
                    
                    <!-- Nueva Venta -->
                    <div v-if="currentView === 'sales'" class="flex flex-col lg:flex-row gap-6">
                        <!-- Productos -->
                        <div class="lg:w-2/3">
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-xl font-bold text-gray-800">Productos Disponibles</h2>
                                    <div class="flex space-x-2">
                                        <select v-model="selectedCategory" @change="filterProducts" class="px-3 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400 text-sm">
                                            <option value="">Todas las categorías</option>
                                            <option v-for="category in categories" :value="category">{{ category }}</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Lista de Productos -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                    <div v-for="product in filteredProducts" :key="product.id" class="bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                                        <div class="bg-yellow-50 p-4 flex justify-center">
                                            <img :src="product.image || 'https://via.placeholder.com/150'" :alt="product.name" class="h-32 object-contain">
                                        </div>
                                        <div class="p-4">
                                            <h3 class="font-semibold text-gray-800">{{ product.name }}</h3>
                                            <p class="text-gray-600 text-sm mt-1">{{ product.description || 'Sin descripción' }}</p>
                                            <div class="flex justify-between items-center mt-3">
                                                <span class="font-bold text-yellow-600">${{ product.price.toFixed(2) }}</span>
                                                <button @click="addToCart(product.id)" class="bg-yellow-400 hover:bg-yellow-500 text-white p-2 rounded-full">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Carrito -->
                        <div class="lg:w-1/3">
                            <div class="bg-white rounded-lg shadow p-6 sticky top-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h2 class="text-xl font-bold text-gray-800">Carrito de Venta</h2>
                                    <span class="bg-yellow-400 text-white px-2 py-1 rounded-full text-xs">{{ Object.keys(cart).length }} items</span>
                                </div>
                                
                                <!-- Items del Carrito -->
                                <div class="space-y-4 mb-6 max-h-96 overflow-y-auto">
                                    <div v-for="(item, productId) in cart" :key="productId" class="flex justify-between items-start border-b border-gray-100 pb-4">
                                        <div class="flex">
                                            <div class="bg-yellow-50 p-2 rounded-lg">
                                                <img :src="item.image || 'https://via.placeholder.com/60'" :alt="item.name" class="w-12 h-12 object-contain">
                                            </div>
                                            <div class="ml-3">
                                                <h4 class="font-medium text-gray-800">{{ item.name }}</h4>
                                                <p class="text-gray-600 text-sm">${{ item.price.toFixed(2) }} c/u</p>
                                                <div class="flex items-center mt-1">
                                                    <button @click="decreaseQuantity(productId)" class="text-gray-500 hover:text-yellow-500">
                                                        <i class="fas fa-minus-circle"></i>
                                                    </button>
                                                    <span class="mx-2">{{ item.quantity }}</span>
                                                    <button @click="increaseQuantity(productId)" class="text-gray-500 hover:text-yellow-500">
                                                        <i class="fas fa-plus-circle"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-semibold text-yellow-600">${{ (item.price * item.quantity).toFixed(2) }}</p>
                                            <button @click="removeFromCart(productId)" class="text-gray-400 hover:text-red-500 mt-2">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Resumen -->
                                <div class="border-t border-gray-200 pt-4">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-600">Subtotal:</span>
                                        <span class="font-medium">${{ calculateSubtotal().toFixed(2) }}</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-600">IVA (16%):</span>
                                        <span class="font-medium">${{ (calculateSubtotal() * 0.16).toFixed(2) }}</span>
                                    </div>
                                    <div class="flex justify-between font-bold text-lg mt-4 pt-2 border-t border-gray-200">
                                        <span>Total:</span>
                                        <span class="text-yellow-600">${{ calculateTotal().toFixed(2) }}</span>
                                    </div>
                                </div>
                                
                                <!-- Acciones -->
                                <div class="mt-6 space-y-3">
                                    <button @click="checkout" class="w-full bg-yellow-400 hover:bg-yellow-500 text-white py-3 rounded-lg font-semibold flex items-center justify-center">
                                        <i class="fas fa-cash-register mr-2"></i> Finalizar Venta
                                    </button>
                                    <button @click="clearCart" class="w-full bg-white border border-gray-300 text-gray-600 py-3 rounded-lg font-semibold hover:bg-gray-50 flex items-center justify-center">
                                        <i class="fas fa-trash-alt mr-2"></i> Limpiar Carrito
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Historial de Ventas -->
                    <div v-if="currentView === 'history'" class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-6">Historial de Ventas</h2>
                            
                            <div v-if="sales.length > 0" class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID Venta</th>
                                            <th v-if="userRole === 'vendedor'" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Comprador</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Productos</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr v-for="sale in sales" :key="sale.id">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ formatDate(sale.date) }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.id.substring(0, 8) }}</td>
                                            <td v-if="userRole === 'vendedor'" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ sale.buyerName }}</td>
                                            <td class="px-6 py-4 text-sm text-gray-500">
                                                <div v-for="(item, productId) in sale.items" :key="productId" class="mb-1">
                                                    {{ item.quantity }} x {{ item.name }} (${{ item.price.toFixed(2) }})
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-yellow-600">${{ sale.total.toFixed(2) }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p v-else class="text-gray-500">No hay ventas registradas</p>
                        </div>
                    </div>
                    
                    <!-- Lista de Productos (Vendedor) -->
                    <div v-if="currentView === 'products' && userRole === 'vendedor'" class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold text-gray-800">Inventario de Productos</h2>
                                <button @click="currentView = 'add-product'" class="px-4 py-2 bg-yellow-400 text-white rounded-lg hover:bg-yellow-500 flex items-center">
                                    <i class="fas fa-plus mr-2"></i> Agregar Producto
                                </button>
                            </div>
                            
                            <div v-if="products.length > 0" class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Producto</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descripción</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Precio</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stock</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr v-for="product in products" :key="product.id">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 h-10 w-10 bg-yellow-50 rounded-lg flex items-center justify-center">
                                                        <img :src="product.image || 'https://via.placeholder.com/40'" :alt="product.name" class="h-8 w-8 object-contain">
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900">{{ product.name }}</div>
                                                        <div class="text-sm text-gray-500">{{ product.category }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="text-sm text-gray-500 max-w-xs truncate">{{ product.description || 'Sin descripción' }}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-yellow-600">${{ product.price.toFixed(2) }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ product.stock }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <button @click="editProduct(product)" class="text-yellow-600 hover:text-yellow-800 mr-3">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button @click="confirmDeleteProduct(product.id)" class="text-red-600 hover:text-red-800">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <p v-else class="text-gray-500">No hay productos registrados</p>
                        </div>
                    </div>
                    
                    <!-- Agregar/Editar Producto -->
                    <div v-if="(currentView === 'add-product' || currentView === 'edit-product') && userRole === 'vendedor'" class="bg-white rounded-lg shadow p-6 max-w-2xl mx-auto">
                        <h2 class="text-xl font-bold text-gray-800 mb-6">{{ editingProduct ? 'Editar Producto' : 'Agregar Nuevo Producto' }}</h2>
                        
                        <form @submit.prevent="saveProduct">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-gray-700 mb-2">Nombre*</label>
                                    <input v-model="productForm.name" type="text" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 mb-2">Categoría*</label>
                                    <input v-model="productForm.category" type="text" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                                </div>
                                
                                <div class="md:col-span-2">
                                    <label class="block text-gray-700 mb-2">Descripción</label>
                                    <textarea v-model="productForm.description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 mb-2">Precio*</label>
                                    <input v-model="productForm.price" type="number" step="0.01" min="0" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 mb-2">Stock*</label>
                                    <input v-model="productForm.stock" type="number" min="0" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400" required>
                                </div>
                                
                                <div class="md:col-span-2">
                                    <label class="block text-gray-700 mb-2">Imagen (URL)</label>
                                    <input v-model="productForm.image" type="url" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                </div>
                            </div>
                            
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" @click="cancelEdit" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                    Cancelar
                                </button>
                                <button type="submit" class="px-4 py-2 bg-yellow-400 text-white rounded-lg hover:bg-yellow-500">
                                    {{ editingProduct ? 'Actualizar Producto' : 'Agregar Producto' }}
                                </button>
                            </div>
                        </form>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Firebase y Vue -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD3wwF3-E02dRP7Z8MH1k11UeR_pVqL66k",
            authDomain: "tienda-e1a2e.firebaseapp.com",
            databaseURL: "https://tienda-e1a2e-default-rtdb.firebaseio.com",
            projectId: "tienda-e1a2e",
            storageBucket: "tienda-e1a2e.appspot.com",
            messagingSenderId: "706488670782",
            appId: "1:706488670782:web:226c0feaa3cf3213b50f6f"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Aplicación Vue
        new Vue({
            el: '#app',
            data: {
                // Autenticación
                currentUser: null,
                userRole: '',
                userName: '',
                showLogin: true,
                loginEmail: '',
                loginPassword: '',
                signupName: '',
                signupEmail: '',
                signupPassword: '',
                signupRole: 'comprador',
                
                // Sistema POS
                currentView: 'dashboard',
                searchQuery: '',
                selectedCategory: '',
                categories: [],
                products: [],
                filteredProducts: [],
                cart: {},
                sales: [],
                notificationsCount: 0,
                isSidebarCollapsed: false,
                
                // Gestión de productos
                editingProduct: null,
                productForm: {
                    name: '',
                    description: '',
                    price: 0,
                    stock: 0,
                    category: '',
                    image: ''
                }
            },
            created() {
                // Escuchar cambios de autenticación
                auth.onAuthStateChanged(user => {
                    this.currentUser = user;
                    if (user) {
                        this.loadUserData(user.uid);
                    } else {
                        this.userRole = '';
                        this.userName = '';
                    }
                });
            },
            methods: {
                // Autenticación
                toggleAuthForm() {
                    this.showLogin = !this.showLogin;
                },
                login() {
                    auth.signInWithEmailAndPassword(this.loginEmail, this.loginPassword)
                        .catch(error => {
                            alert('Error al iniciar sesión: ' + error.message);
                        });
                },
                signup() {
                    auth.createUserWithEmailAndPassword(this.signupEmail, this.signupPassword)
                        .then(userCredential => {
                            // Guardar información adicional del usuario
                            return database.ref('users/' + userCredential.user.uid).set({
                                name: this.signupName,
                                email: this.signupEmail,
                                role: this.signupRole,
                                createdAt: firebase.database.ServerValue.TIMESTAMP
                            });
                        })
                        .catch(error => {
                            alert('Error al registrarse: ' + error.message);
                        });
                },
                logout() {
                    auth.signOut();
                    this.currentView = 'dashboard';
                    this.cart = {};
                },
                
                // Cargar datos del usuario
                loadUserData(userId) {
                    database.ref('users/' + userId).on('value', snapshot => {
                        const userData = snapshot.val();
                        if (userData) {
                            this.userRole = userData.role;
                            this.userName = userData.name;
                            
                            // Cargar datos según el rol
                            this.loadProducts();
                            if (this.userRole === 'vendedor') {
                                this.loadSales();
                            } else {
                                this.loadUserSales(userId);
                            }
                        }
                    });
                },
                
                // Productos
                loadProducts() {
                    database.ref('products').on('value', snapshot => {
                        this.products = [];
                        const categories = new Set();
                        
                        snapshot.forEach(childSnapshot => {
                            const product = childSnapshot.val();
                            product.id = childSnapshot.key;
                            this.products.push(product);
                            
                            if (product.category) {
                                categories.add(product.category);
                            }
                        });
                        
                        this.categories = Array.from(categories);
                        this.filterProducts();
                    });
                },
                filterProducts() {
                    this.filteredProducts = this.products.filter(product => {
                        const matchesSearch = product.name.toLowerCase().includes(this.searchQuery.toLowerCase()) || 
                                             product.description.toLowerCase().includes(this.searchQuery.toLowerCase());
                        const matchesCategory = !this.selectedCategory || product.category === this.selectedCategory;
                        return matchesSearch && matchesCategory;
                    });
                },
                
                // Carrito
                addToCart(productId) {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) return;
                    
                    if (this.cart[productId]) {
                        this.cart[productId].quantity += 1;
                    } else {
                        this.cart[productId] = {
                            ...product,
                            quantity: 1
                        };
                    }
                },
                increaseQuantity(productId) {
                    if (this.cart[productId]) {
                        this.cart[productId].quantity += 1;
                    }
                },
                decreaseQuantity(productId) {
                    if (this.cart[productId]) {
                        if (this.cart[productId].quantity > 1) {
                            this.cart[productId].quantity -= 1;
                        } else {
                            this.removeFromCart(productId);
                        }
                    }
                },
                removeFromCart(productId) {
                    Vue.delete(this.cart, productId);
                },
                clearCart() {
                    this.cart = {};
                },
                calculateSubtotal() {
                    return Object.values(this.cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
                },
                calculateTotal() {
                    return this.calculateSubtotal() * 1.16;
                },
                checkout() {
                    if (Object.keys(this.cart).length === 0) {
                        alert('El carrito está vacío');
                        return;
                    }
                    
                    if (this.userRole !== 'comprador') {
                        alert('Solo los compradores pueden realizar compras');
                        return;
                    }
                    
                    const saleData = {
                        buyerId: this.currentUser.uid,
                        buyerName: this.userName,
                        items: this.cart,
                        subtotal: this.calculateSubtotal(),
                        iva: this.calculateSubtotal() * 0.16,
                        total: this.calculateTotal(),
                        date: firebase.database.ServerValue.TIMESTAMP,
                        status: 'completed'
                    };
                    
                    database.ref('sales').push(saleData)
                        .then(() => {
                            alert('Venta realizada con éxito');
                            this.clearCart();
                            this.currentView = 'history';
                        })
                        .catch(error => {
                            alert('Error al realizar la venta: ' + error.message);
                        });
                },
                
                // Ventas
                loadSales() {
                    database.ref('sales').orderByChild('date').limitToLast(50).on('value', snapshot => {
                        this.sales = [];
                        snapshot.forEach(childSnapshot => {
                            const sale = childSnapshot.val();
                            sale.id = childSnapshot.key;
                            this.sales.unshift(sale);
                        });
                    });
                },
                loadUserSales(userId) {
                    database.ref('sales').orderByChild('buyerId').equalTo(userId).limitToLast(50).on('value', snapshot => {
                        this.sales = [];
                        snapshot.forEach(childSnapshot => {
                            const sale = childSnapshot.val();
                            sale.id = childSnapshot.key;
                            this.sales.unshift(sale);
                        });
                    });
                },
                
                // Gestión de productos (vendedor)
                editProduct(product) {
                    this.editingProduct = product;
                    this.productForm = {
                        name: product.name,
                        description: product.description || '',
                        price: product.price,
                        stock: product.stock,
                        category: product.category || '',
                        image: product.image || ''
                    };
                    this.currentView = 'edit-product';
                },
                saveProduct() {
                    const productData = {
                        name: this.productForm.name,
                        description: this.productForm.description,
                        price: parseFloat(this.productForm.price),
                        stock: parseInt(this.productForm.stock),
                        category: this.productForm.category,
                        image: this.productForm.image,
                        vendorId: this.currentUser.uid,
                        vendorName: this.userName,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    if (this.editingProduct) {
                        // Actualizar producto existente
                        database.ref('products/' + this.editingProduct.id).update(productData)
                            .then(() => {
                                alert('Producto actualizado con éxito');
                                this.cancelEdit();
                            })
                            .catch(error => {
                                alert('Error al actualizar producto: ' + error.message);
                            });
                    } else {
                        // Agregar nuevo producto
                        productData.createdAt = firebase.database.ServerValue.TIMESTAMP;
                        database.ref('products').push(productData)
                            .then(() => {
                                alert('Producto agregado con éxito');
                                this.cancelEdit();
                            })
                            .catch(error => {
                                alert('Error al agregar producto: ' + error.message);
                            });
                    }
                },
                confirmDeleteProduct(productId) {
                    if (confirm('¿Estás seguro de eliminar este producto?')) {
                        database.ref('products/' + productId).remove()
                            .then(() => {
                                alert('Producto eliminado con éxito');
                            })
                            .catch(error => {
                                alert('Error al eliminar producto: ' + error.message);
                            });
                    }
                },
                cancelEdit() {
                    this.editingProduct = null;
                    this.productForm = {
                        name: '',
                        description: '',
                        price: 0,
                        stock: 0,
                        category: '',
                        image: ''
                    };
                    this.currentView = 'products';
                },
                
                // Utilidades
                formatDate(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                },
                toggleSidebar() {
                    this.isSidebarCollapsed = !this.isSidebarCollapsed;
                }
            }
        });
    </script>
</body>
</html>
